<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<!-- Craziness: http://stackoverflow.com/questions/8146926/why-does-ie-restrict-the-javascript-files-of-local-html-pages -->
<html>
<head lang="en">
<meta charset="UTF-8">
<title>Play 1</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/autosize.js/1.18.15/jquery.autosize.min.js"></script>
    <script src="http://imagesloaded.desandro.com/imagesloaded.pkgd.min.js"></script>
    <!-- see: http://underscorejs.org/ -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore.js"></script>
    <script src="helpers.js"></script>
    <script src="creature.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css"/>
<script>
	
    // Returns 2-d grid of all possible creatures
    function createCreatureGrid() {
        var body_types = crossProduct(Creature.BODY_SHAPES, Creature.BODY_COLOURS),
            face_types = crossProduct(Creature.EYE_SHAPES, Creature.LIP_SHAPES);

        return grid(face_types, body_types, function(faceType, bodyType) {
            return new Creature({
                eyeShape: faceType[0],
                lipShape: faceType[1],
                bodyShape: bodyType[0],
                bodyColour: bodyType[1]
            });
        });
    }

    // Renders 2-d grid of creatures into a table
    function createCreatureTable(parent, tableData) {
        var table = $('<table style="creature-table"></table>');
        _.each(tableData, function(row) {
            var tr = $('<tr></tr>');
            _.each(row, function(creature) {
                var cell = $('<td>' + creature.toHtmlText() + '</td>');
                cell.data(creature);
                tr.append(cell);
                cell.append(creature.toCanvas());
            });
            table.append(tr);
        });
        parent.append(table);
    }

    // Sum all creatures' willingness to approach each other
    function calculateGlobalLove() {
        var loveTotal = 0;
          //  hateTotal = 0,
          //  mehTotal = 0;

        // O(n^2) and we don't care!  Note: Love and hate are not symmetric. We include ourselves!
        _.each(creatureList, function(me) {
            _.each(creatureList, function(them) {
                var status = me.compatibility(them);
                switch (me.compatibility(them)) {
                    case 'approach': loveTotal++; break;
                    case 'avoid': break;
					
                    default:
                        console.log("BUG IN COMPATIBILITY EVALUATION!");
                }
            });

        });
        return loveTotal;
    }

    function updateStatsGrid(initialLove, maxLove) {
        var loveTotal = calculateGlobalLove();
        $('#loveTotal').val(loveTotal);
        $('#loveLevel').val(((loveTotal-initialLove)/(maxLove-initialLove)));
        //$('#mehTotal').val(stats.mehTotal);
    }

    function updateInspectorPanel(creature) {
        $('#creatureId').val(creature.id);
        $('#creatureLoves').val(creature.countApproachable(creatureList));
    }

    // Create the grid of creatures
    window.creatureGrid = createCreatureGrid();
    window.creatureList = _.flatten(creatureGrid);

    $(document).ready(function() {
        // All other code needs to run after images are preloaded.
        Creature.preloadImageTiles(function() {

            // Render the creatures into a table
            createCreatureTable($('#creatureTableDiv'), creatureGrid);

            // Add an onclick function to all table cells which will update
            // the creature inspector.
            $('td').click(function (event) {
                var tableCell = event.currentTarget;
                var selectedCreature = $(tableCell).data();
                updateInspectorPanel(selectedCreature);
                event.stopPropagation();
            });

            // Set up the function area for autosizing function area
            $('textarea').autosize();

            // Evaluate the loves/hates function
            $('#evalBtn').click(function (evt) {
                var fn = $('#expr').val();
                try {
                    eval(fn);
                } catch(e) {
                    alert(e);
                }
                $('td').each(function(idx, elem) {
                    var td = $(elem);
                    var creature = $(td).data();
                    var newStyle = likesOrHates(creature);
                    td.removeClass();
                    td.addClass(newStyle);
                });
            });

            $('#statsBtn').click(function(evt) {
                updateStatsGrid();
            });

            // set values for initial global stats

            var initialLove = calculateGlobalLove();
            $('#initialLove').val(initialLove);

            var maxLove = creatureList.length * creatureList.length;
            $('#maxLove').val(maxLove);

            updateStatsGrid(initialLove, maxLove);

        });
    });
</script>

</head>
<body>

<div id="creatureTableDiv"></div>

<div id="creatureDetailDiv">
    <p>CREATURE DETAILS</p>

    <label for="creatureId">ID:</label>
    <input id="creatureId" type="text"/><br/>

    <label for="creatureLoves">Love Level:</label>
    <input id="creatureLoves" type="text"/> / 144<br/>


</div>

<div id="globalStatsDiv">
    <p>GLOBAL LOVE STATS:</p>

    <label for="loveTotal">Current Love:</label>
    <input id="loveTotal" type="text"/><br/>
	
	<label for="initialLove">Initial Love:</label>
    <input id="initialLove" type="text"/><br/> 
	
	
	<label for="maxLove">Max Love:</label>
    <input id="maxLove" type="text"/><br/> 
	
	<label for="loveLevel">Love level (100 = max achieved):</label>
    <input id="loveLevel" type="text"/><br/>

    <button id="statsBtn">Update</button>
</div>

<div id="expressionDiv">
    <textarea id="expr" style="width: 600px; clear: both;">
window.likesOrHates = function(creature) {
    // Can check: creature.eyeShape, creature.bodyShape, creature.bodyColour, creature.bodyShape
    // Expected return value: 'hate', 'love', or 'meh'
    // HATE SQUARES
    if(creature.bodyShape == 'squareBody') {
        return 'hate';
    }
    // LOVE PURPLES
    if(creature.bodyColour == 'purpleBody') {
        return 'love';
    }
    return 'meh';
}
    </textarea>
    <br>
    <button id="evalBtn" name="Evaluate">EVALUATE</button>
</div>

</body>
</html>